<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <meta name="viewport"
          content="initial-scale=1, width=device-width, height=device-height, viewport-fit=cover, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="csrf-param" content="_csrf-frontend">
    <meta name="csrf-token" content="bXpvY3lwS2I9LgYoLRkpExVKOTEhGxQLJgIjGxIbfD1dICU5PAYZEw==">
    <meta name="keywords" content="部落格">
    <meta name="description" content="部落格">
    <link href="./assets/css/main.css" rel="stylesheet">
    <script src="./assets/js/jquery-1.7.2.min.js"></script>
    <script src="./assets/js/base.js"></script>
</head>
<body>
<header>
    <span class="bg-logo" onclick="window.location.href='index.html'">
        <img id="bg-logo" src="" onerror="this.src='./assets/imgs/error.jpg'" alt="">
    </span>
    <span class="bg-menu" onclick="window.location.href='keyword.html'"></span>
</header>
<article>
    <h2></h2>
    <div class="detail">

    </div>
    <div class="detail_bottom">
        <span class="bg-star"></span>&nbsp;<i class="i_star">0</i>&nbsp;<span class="bg-like"></span>&nbsp;<i
            class="i_like">0</i>
    </div>
</article>
<section class="comment_zone">
    <h3>评论区</h3>
    <div class="c_item">

    </div>
    <div class="more_div" style="display:none;"><span onclick="getComment()">更多</span></div>
</section>
</body>
<script>
    var d_id = window.location.href.split("id=")[1];
    $(document).ready(function () {
        setConfiguration();
        $.ajax({
            url: apiUrl + "/v1/h5/blog/article-detail",
            type: "get",
            dataType: "json",
            data: {id: d_id},
            success: function (rs) {
                if (rs) {
                    $("article h2").html(rs['title']);
                    $(".detail").html(rs['content']);
                    $(".i_star").html(rs['count_collect']);
                    $(".i_like").html(rs['count_favour']);
                }
            }, err: function (err) {
                alert(err);
            }
        });
        getComment();
    });

    var pages = {
        page: 1,
        pageSize: 20,
        hasNext: true
    };
    //分页获取评论
    var getComment = function () {
        $.ajax({
            url: apiUrl + "/v1/h5/blog/get-comment",
            type: "get",
            dataType: "json",
            data: {id: d_id, page: pages.page, per_page: pages.pageSize},
            success: function (rs) {
                if (rs) {
                    var data = rs.data;
                    // var rPages = rs.total;
                    var c_item = "";
                    var childList = [];
                    if (data.length > 0) {
                        data.forEach(function (v) {
                            c_item += "<div class='com_item'>\n" +
                                // "<h4 " + (v['pid'] !== '0' ? "class='b_reply'" : "") + ">" + v['name'] + "</h4>\n" +
                                "<h4>" + v['name'] + "</h4>\n" +
                                "<p>" + v['content'] + "</p>\n" +
                                "</div>";
                            childList = v.child.list;
                            if (childList.length > 0) {
                                childList.forEach(function (k) {
                                    c_item += "<div class='com_item'>\n" +
                                        "<h4 class='b_reply'>" + k['name'] + "回复" + k['reply_name'] + "</h4>\n" +
                                        "<p>" + k['content'] + "</p>\n" +
                                        "</div>";
                                })
                            }
                        });
                    } else {
                        c_item += "<div class='com_item'>还没有用户评论</div>";
                    }
                    $(".c_item").append(c_item);
                    if (rs.total > 0) {
                        pages.hasNext = rs.current_page * rs.per_page < rs.total;
                        if (pages.hasNext) {
                            pages.page++;
                            $(".more_div").show();
                        } else {
                            $(".more_div").hide();
                        }
                    }
                } else {
                    alert(rs.msg);
                }
            }, err: function (err) {
                alert(err);
            }
        });
    }

    //设置网站配置
    function setConfiguration() {
        var site_name = localStorage.getItem("site_name");
        var site_icon = localStorage.getItem("site_icon");
        var site_logo = localStorage.getItem("site_logo");
        document.title = site_name;
        setFavicon(site_icon);
        $("#bg-logo").attr("src", site_logo);
    }
</script>
</html>