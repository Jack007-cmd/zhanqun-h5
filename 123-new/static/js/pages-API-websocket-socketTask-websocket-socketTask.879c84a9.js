(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-API-websocket-socketTask-websocket-socketTask"],{"1af9":function(e,t,n){"use strict";n("d3b7"),n("e25e"),n("25f0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=uni.getSystemInfoSync().platform,s={data:function(){return{connected:!1,connecting:!1,socketTask:!1,msg:!1,timeoutObj:null,messageType:-1,messageContent:""}},computed:{showMsg:function(){return this.connected?this.msg?"收到消息："+this.msg:"等待接收消息":"尚未连接"}},onUnload:function(){uni.hideLoading(),this.socketTask&&this.socketTask.close&&this.socketTask.close()},methods:{connect:function(){var e=this;if(this.connected||this.connecting)return uni.showModal({content:"正在连接或者已经连接，请勿重复连接",showCancel:!1}),!1;this.connecting=!0,uni.showLoading({title:"连接中..."}),this.socketTask=uni.connectSocket({url:"ws://422.zhanqun.com:9502/",data:function(){return{msg:"Hello"}},success:function(e){},fail:function(e){}}),console.log(this.socketTask),this.socketTask.onOpen((function(t){e.connecting=!1,e.connected=!0,uni.hideLoading(),uni.showToast({icon:"none",title:"连接成功"}),console.log("onOpen",t);var n={data:'{"cmds":[{"cmd":"longQueueNotice","data":[]},{"cmd":"lotteryWinNotice","data":[]},{"cmd":"omitRemind","data":[]}],"time":"'+e.getCurrentDate()+'"}',success:function(e){console.log(e)},fail:function(e){console.log(e)}};e.socketTask.send(n),e.reset(),e.start()})),this.socketTask.onError((function(t){e.connecting=!1,e.connected=!1,uni.hideLoading(),uni.showModal({content:"连接失败，可能是websocket服务不可用，请稍后再试",showCancel:!1}),console.log("onError",t),e.connect()})),this.socketTask.onMessage((function(t){e.msg=t.data;var n=e;console.log("onMessage",t);var o=JSON.parse(t.data);if(o.pong)n.reset(),n.start();else if(o.message){if(o=o.message,o.payload=JSON.parse(o.payload),"longQueueNotice"==o.cmd)n.messageType=1,n.messageContent="长龙通知："+o.payload["lottery_name"]+"/"+o.payload["desc"]+"/连"+("notOpen"==o.payload["state"]?"续"+o.payload["num"]+"期未开":"开"+o.payload["num"]+"期");else if("lotteryWinNotice"==o.cmd)n.messageType=2,n.messageContent="通知："+o.payload["lottery_name"]+"出现【"+o.payload["desc"]+"】";else if("omitRemind"==o.cmd){n.messageType=3;var s=o.payload["code_name"]+o.payload["position_name"]+"【"+o.payload["num"]+"】当前遗漏已超过最大遗漏的80%";s.length>22?n.messageContent=s.substr(0,20)+"...":n.messageContent=s}n.timeout=setTimeout((function(){n.messageType=-1,n.messageContent=""}),5e3)}o.subscribeState&&(1===o.subscribeState?console.log("订阅成功"):console.error("订阅失败"))})),this.socketTask.onClose((function(t){e.connected=!1,e.startRecive=!1,e.socketTask=!1,e.msg=!1,console.log("onClose",t)})),console.log("task",this.socketTask)},send:function(){this.socketTask.send({data:"from "+o+" : "+parseInt(1e4*Math.random()).toString(),success:function(e){console.log(e)},fail:function(e){console.log(e)}})},close:function(){this.socketTask&&this.socketTask.close&&this.socketTask.close()},reset:function(){clearTimeout(this.timeoutObj)},start:function(){var e=this;e.timeoutObj=setTimeout((function(){e.socketTask.send({data:'{"cmds":[{"cmd":"ping","data":[]}],"time":"'+e.getCurrentDate()+'"}',success:function(e){console.log(e)},fail:function(e){console.log(e)}})}),6e4)},getCurrentDate:function(){var e=new Date,t=e.getMonth()+1,n=e.getFullYear()+"-"+(t<10?"0"+t:t)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();return n}}};t.default=s},"719b":function(e,t,n){"use strict";n.r(t);var o=n("784b"),s=n("dad2");for(var a in s)"default"!==a&&function(e){n.d(t,e,(function(){return s[e]}))}(a);n("d7d5");var c,i=n("f0c5"),u=Object(i["a"])(s["default"],o["b"],o["c"],!1,null,"66854ef1",null,!1,o["a"],c);t["default"]=u.exports},"784b":function(e,t,n){"use strict";var o,s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("page-head",{attrs:{title:"websocket通讯示例"}}),n("v-uni-view",{staticClass:"uni-padding-wrap"},[n("v-uni-view",{staticClass:"uni-btn-v"},[n("v-uni-view",{staticClass:"websocket-msg"},[e._v(e._s(e.showMsg))]),n("v-uni-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.connect.apply(void 0,arguments)}}},[e._v("连接websocket服务")]),n("v-uni-button",{directives:[{name:"show",rawName:"v-show",value:e.connected,expression:"connected"}],attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.send.apply(void 0,arguments)}}},[e._v("发送一条消息")]),n("v-uni-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.close.apply(void 0,arguments)}}},[e._v("断开websocket服务")]),n("v-uni-view",{staticClass:"websocket-tips"},[e._v("发送消息后会收到一条服务器返回的消息（与发送的消息内容一致）")])],1)],1)],1)},a=[];n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}))},d7d5:function(e,t,n){"use strict";var o=n("db99"),s=n.n(o);s.a},dad2:function(e,t,n){"use strict";n.r(t);var o=n("1af9"),s=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=s.a},db99:function(e,t,n){var o=n("fb6d");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var s=n("4f06").default;s("ccf7d29e",o,!0,{sourceMap:!1,shadowMode:!1})},fb6d:function(e,t,n){var o=n("24fb");t=o(!1),t.push([e.i,".uni-padding-wrap[data-v-66854ef1]{width:%?690?%;padding:0 %?30?%}.uni-btn-v[data-v-66854ef1]{padding:%?10?% 0}.uni-btn-v uni-button[data-v-66854ef1]{margin:%?20?% 0}.websocket-msg[data-v-66854ef1]{padding:40px 0;text-align:center;font-size:14px;line-height:40px;color:#666}.websocket-tips[data-v-66854ef1]{padding:40px 0;text-align:center;font-size:14px;line-height:24px;color:#666}",""]),e.exports=t}}]);